---
layout: post
title: Getting Choosy
date: 2015-01-10 14:03:46.000000000 -05:00
type: post
published: true
status: publish
categories:
- '1'
tags: []
meta:
  _wpcom_is_markdown: '1'
  sharing_disabled: '1'
  _wpas_skip_facebook: '1'
  _wpas_skip_google_plus: '1'
  _wpas_skip_twitter: '1'
  _wpas_skip_linkedin: '1'
  _wpas_skip_tumblr: '1'
  _wpas_skip_path: '1'
  _publicize_pending: '1'
  _rest_api_published: '1'
  _rest_api_client_id: '-1'
author:
  login: 2shortplanks
  email: mark@twoshortplanks.com
  display_name: 2shortplanks
  first_name: Mark
  last_name: Fowler
---
<p>Today I released a new version of <a href="https://metacpan.org/pod/Mac::Choose">Mac::Choose</a> which wraps the choose command line utility. Basically this lets you, from Perl, pop open a fuzzy match dialog like quicksilver, alfred, et al. This is probably best shown rather than explained:</p>
<pre><code>use Mac::Choose qw(choose);
print choose qw(
      red
      orange
      yellow
      green
      blue
      indigo
      violet
) or die "User canceled selection";</code></pre>
<p><a href="https://twoshortplanks.files.wordpress.com/2015/01/choose_example_demo.gif"><img class="alignnone size-full wp-image-415" src="{{ site.baseurl }}/assets/choose_example_demo.gif" alt="choose_example_demo" width="660" height="357" /></a></p>
<p>The exciting thing about this release is that while previous versions required you to go to <a href="https://tinyrobotsoftware.com/choose/">Tiny Robot Software's website</a> to download a copy of <code>choose</code>, this version of Mac::Choose ships with the <code>choose</code> binary and installs a copy alongside the Perl module.</p>
<h2>Using File::ShareDir</h2>
<p>In order to handle the intallation of the binary in a place where my code could once again find it I altered my distribution to use the <a href="https://metacpan.org/pod/File::ShareDir">File::ShareDir</a> infrastructure. Essentially this infrastructure comes in two halves, an installer to install things in the shared dirctory and a module that can give you access to the files again.</p>
<p>In my Module::Intall powered Makefile.PL in order to use <a href="https://metacpan.org/pod/Module::Install::Share">Module::Intall::Share</a> I simply had to add the line:</p>
<pre><code>install_share;</code></pre>
<p>This installs everything in the <code>share</code> directory of my distribution (which just contained one file, the <code>choose</code> binary) when you <code>make install</code>.</p>
<p>The changes to my module were also very simple:</p>
<pre><code>use File::ShareDir qw(dist_file);
our $executable_path = dist_file("Mac-Choose","choose");</code></pre>
<h2>Testing</h2>
<p>After those changes, everything worked flawlessly...apart from the test suite! The problem is that until the module is installed the files aren't in the shared directory, and traditionally we test a module <i>before</i> we install them.</p>
<p>This isn't insurmountable however, we just need to make some changes to our tests to quietly override File::ShareDir's functionality with that from <a href="https://metacpan.org/pod/Test::File::ShareDir">Test::File::ShareDir</a>:</p>
<pre><code>use File::Spec::Functions qw(:ALL);
use FindBin;
use Test::File::ShareDir (
    -root =&gt; catdir($FindBin::Bin, updir),
    -share =&gt; { -dist =&gt; { "Mac-Choose" =&gt; "share" } },
);</code></pre>
